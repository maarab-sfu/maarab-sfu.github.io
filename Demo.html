<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ImageShield Demo</title>
</head>
<body>

<h2>1. Protect Image (Embedding)</h2>

<input type="file" id="embedInput" accept="image/*">
<br><br>
<button onclick="runEmbed()">Protect Image</button>

<br><br>
<img id="embedPreview" width="256">
<br><br>
<img id="protectedImage" width="256">
<br><br>
<a id="downloadProtected" download>Download Protected Image</a>

<hr>

<h2>2. Detect & Restore (Extraction)</h2>

<input type="file" id="extractInput" accept="image/*">
<br><br>
<button onclick="runExtract()">Run Extraction</button>

<br><br>
<h4>Restored Image</h4>
<img id="restoredImage" width="256">

<h4>Localization Mask</h4>
<img id="maskImage" width="256">

<script>
const API_BASE = "http://13.220.125.117:8000";

function previewImage(input, imgElement) {
  const file = input.files[0];
  if (!file) return;
  imgElement.src = URL.createObjectURL(file);
}

document.getElementById("embedInput").addEventListener("change", () => {
  previewImage(document.getElementById("embedInput"),
               document.getElementById("embedPreview"));
});

async function runEmbed() {
  const fileInput = document.getElementById("embedInput");
  if (!fileInput.files.length) {
    alert("Please select an image.");
    return;
  }

  const formData = new FormData();
  formData.append("file", fileInput.files[0]);

  const res = await fetch(`${API_BASE}/embed`, {
    method: "POST",
    body: formData
  });

  const data = await res.json();
  if (!data.success) {
    alert("Embedding failed");
    return;
  }

  const imgUrl = API_BASE + data.protected_image;
  const img = document.getElementById("protectedImage");
  img.src = imgUrl;

  const dl = document.getElementById("downloadProtected");
  dl.href = imgUrl;
}

async function runExtract() {
  const fileInput = document.getElementById("extractInput");
  if (!fileInput.files.length) {
    alert("Please select an image.");
    return;
  }

  const formData = new FormData();
  formData.append("file", fileInput.files[0]);

  const res = await fetch(`${API_BASE}/extract`, {
    method: "POST",
    body: formData
  });

  const data = await res.json();
  if (!data.success) {
    alert("Extraction failed");
    return;
  }

  document.getElementById("restoredImage").src =
    API_BASE + data.restored_image;

  document.getElementById("maskImage").src =
    API_BASE + data.localization_mask;
}
</script>

</body>
</html>